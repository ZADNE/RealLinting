name: Real formatting check
description: Checks that a repository is formatted according to Real style
inputs:
  clang-tidy:
    description: The clang-tidy to use
    default: clang-tidy
  compile-commands-json:
    description: Absolute file path to the compile_commands.json file generated by CMake
  report-file:
    description: The file that will contain errors and warnings reported by clang-tidy
    default: ./clang-tidy-report.txt

runs:
  using: "composite"
  steps:
    - name: Clone RealLinting
      uses: actions/checkout@v4

    - name: Run clang-tidy
      shell: bash
      run: |
        python ${{ github.workspace }}/RealLinting/run-clang-tidy.py ${{ input.clang-tidy }} ${{ input.compile-commands-json }} ${{ input.report-file }}

    - name: Check report
      shell: bash
      run: |
        if [ -s ${{ input.report-file }} ]; then
          echo "Some files did not pass linting! Report follows:"
          cat ${{ input.report-file }}
          exit 1
        fi